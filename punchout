<!DOCTYPE html>
<html>
  <head>
    <title>Punch Out Kehadiran</title>
    <script>
      // Lokasi Teaching Factory UTeM (contoh koordinat)
      const TF_LAT = 2.3113;
      const TF_LNG = 102.3217;
      const ALLOWED_RADIUS = 150; // meter

      function toRad(Value) {
        return (Value * Math.PI) / 180;
      }

      function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371e3; // meter
        const œÜ1 = toRad(lat1);
        const œÜ2 = toRad(lat2);
        const ŒîœÜ = toRad(lat2 - lat1);
        const ŒîŒª = toRad(lon2 - lon1);

        const a =
          Math.sin(ŒîœÜ / 2) * Math.sin(ŒîœÜ / 2) +
          Math.cos(œÜ1) * Math.cos(œÜ2) *
          Math.sin(ŒîŒª / 2) * Math.sin(ŒîŒª / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

        return R * c; // dalam meter
      }

      function checkLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (pos) => {
              const userLat = pos.coords.latitude;
              const userLng = pos.coords.longitude;
              const dist = getDistance(userLat, userLng, TF_LAT, TF_LNG);

              if (dist <= ALLOWED_RADIUS) {
                window.location.href = "https://docs.google.com/forms/d/e/1FAIpQLSehy3_RHD2UfHl61RvCcPfsJR6OcNij9R5ufVvqXJztVDWVMw/viewform?usp=pp_url"; // Punch Out Form
              } else {
                alert("‚ùå Anda berada di luar kawasan TF. Punch Out tidak dibenarkan.");
              }
            },
            () => {
              alert("‚ö†Ô∏è Tak dapat kesan lokasi. Sila hidupkan GPS.");
            }
          );
        } else {
          alert("Browser anda tidak sokong GPS.");
        }
      }
    </script>
  </head>
  <body style="text-align:center; font-family:Arial">
    <h2>Punch Out Kehadiran</h2>
    <p>Sila tekan butang di bawah untuk Punch Out (GPS akan disemak).</p>
    <button onclick="checkLocation()" style="padding:10px 20px; font-size:18px;">üìç Punch Out</button>
  </body>
</html>
